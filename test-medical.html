<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Treatment Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .price-display {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .choose-btn {
            background: #ff8c42;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 24px;
            cursor: pointer;
        }
        .radio-option {
            margin: 10px 0;
        }
        .selected {
            border-color: #007bff;
            background-color: #f8f9ff;
        }
    </style>
</head>
<body>
    <h1>Medical Treatment Price Update Test</h1>
    
    <div class="test-section">
        <h2>Current Pricing</h2>
        <div class="price-display">
            <p>Monthly Price: <span id="monthly-price">35,80 €</span></p>
            <p>Total Price: <span id="total-price">35,80 €</span></p>
        </div>
    </div>
    
    <div class="test-section medical-treatment-section">
        <h2>Medical Treatment Options</h2>
        <div class="medical-price">
            <span class="price-amount">23.38 €</span>
            <span>per month</span>
        </div>
        <button type="button" class="choose-btn" id="chooseMedicalBtn">Choose</button>
        
        <div class="medical-options">
            <div class="radio-option">
                <input type="radio" id="medical-2000" name="medical_coverage" value="2000" checked>
                <label for="medical-2000">Up to €2,000 medical treatment cover + €50 preventive care allowance (€23.38)</label>
            </div>
            
            <div class="radio-option">
                <input type="radio" id="medical-5000" name="medical_coverage" value="5000">
                <label for="medical-5000">Up to €5,000 medical treatment cover + €100 preventive care allowance (€33.33)</label>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>Debug Info</h2>
        <div id="debug-info"></div>
        <button onclick="clearStorage()">Clear Storage</button>
        <button onclick="showStorage()">Show Storage</button>
    </div>

    <script>
        // Initialize with sample data
        const samplePlanData = {
            plan: 'smart',
            deductible: '20',
            price: '35,80 €',
            paymentFrequency: 'monthly'
        };
        localStorage.setItem('selectedPlanData', JSON.stringify(samplePlanData));

        // Medical treatment functionality
        const chooseMedicalBtn = document.getElementById('chooseMedicalBtn');
        const medicalSection = document.querySelector('.medical-treatment-section');
        const medicalRadios = document.querySelectorAll('input[name="medical_coverage"]');
        const priceAmount = document.querySelector('.price-amount');
        const monthlyPrice = document.getElementById('monthly-price');
        const totalPrice = document.getElementById('total-price');
        
        const medicalPricing = {
            '2000': { price: '23.38 €', text: 'Up to €2,000 medical treatment cover + €50 preventive care allowance (€23.38)' },
            '5000': { price: '33.33 €', text: 'Up to €5,000 medical treatment cover + €100 preventive care allowance (€33.33)' }
        };
        
        let medicalSelected = false;
        
        // Choose button functionality
        chooseMedicalBtn.addEventListener('click', function() {
            medicalSelected = !medicalSelected;
            
            if (medicalSelected) {
                medicalSection.classList.add('selected');
                chooseMedicalBtn.textContent = 'Remove';
                chooseMedicalBtn.style.background = '#dc3545';
            } else {
                medicalSection.classList.remove('selected');
                chooseMedicalBtn.textContent = 'Choose';
                chooseMedicalBtn.style.background = '#ff8c42';
            }
            
            updateOrderSummary();
        });
        
        // Radio button change handler
        medicalRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                const selectedOption = medicalPricing[this.value];
                if (selectedOption && priceAmount) {
                    priceAmount.textContent = selectedOption.price;
                }
                
                if (medicalSelected) {
                    updateOrderSummary();
                }
            });
        });
        
        function updateOrderSummary() {
            const planData = JSON.parse(localStorage.getItem('selectedPlanData') || '{}');
            const selectedRadio = document.querySelector('input[name="medical_coverage"]:checked');
            
            console.log('Updating medical treatment:', medicalSelected, selectedRadio ? selectedRadio.value : 'none');
            
            if (medicalSelected && selectedRadio) {
                const medicalOption = medicalPricing[selectedRadio.value];
                planData.medicalTreatment = {
                    selected: true,
                    coverage: selectedRadio.value,
                    price: medicalOption.price,
                    description: medicalOption.text
                };
            } else {
                if (planData.medicalTreatment) {
                    delete planData.medicalTreatment;
                }
            }
            
            localStorage.setItem('selectedPlanData', JSON.stringify(planData));
            updatePricing(planData);
            updateDebugInfo(planData);
        }
        
        function updatePricing(planData) {
            let basePrice = parseFloat((planData.price || '35,80 €').replace(',', '.').replace(' €', ''));
            
            if (planData.medicalTreatment && planData.medicalTreatment.selected) {
                const medicalPrice = parseFloat(planData.medicalTreatment.price.replace(',', '.').replace(' €', ''));
                basePrice += medicalPrice;
            }
            
            const formattedPrice = `${basePrice.toFixed(2).replace('.', ',')} €`;
            monthlyPrice.textContent = formattedPrice;
            totalPrice.textContent = formattedPrice;
        }
        
        function updateDebugInfo(planData) {
            const debugDiv = document.getElementById('debug-info');
            debugDiv.innerHTML = `
                <pre>${JSON.stringify(planData, null, 2)}</pre>
                <p>Medical Selected: ${medicalSelected}</p>
                <p>Current Price: ${monthlyPrice.textContent}</p>
            `;
        }
        
        function clearStorage() {
            localStorage.clear();
            location.reload();
        }
        
        function showStorage() {
            const planData = JSON.parse(localStorage.getItem('selectedPlanData') || '{}');
            updateDebugInfo(planData);
        }
        
        // Initialize display
        const planData = JSON.parse(localStorage.getItem('selectedPlanData') || '{}');
        updatePricing(planData);
        updateDebugInfo(planData);
    </script>
</body>
</html>